<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CS2 Case Opener - Choose a Case</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
    }
    h1 { margin-bottom: 40px; }
    .cases-grid {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
    }
    .case-card {
      background: #222;
      border: 3px solid #0a84ff;
      border-radius: 12px;
      padding: 15px;
      width: 180px;
      cursor: pointer;
      transition: border-color 0.3s;
      color: #0a84ff;
      text-decoration: none;
    }
    .case-card:hover {
      border-color: #006fcc;
    }
    .case-card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
      pointer-events: none;
      user-select: none;
    }
    .case-name {
      font-weight: bold;
      font-size: 18px;
    }
    /* Chat styles */
    #chat {
      max-width: 600px;
      margin: 40px auto 0;
      text-align: left;
      background: #222;
      padding: 20px;
      border-radius: 10px;
      border: 3px solid #0a84ff;
      color: #eee;
    }
    #messages {
      height: 250px;
      overflow-y: auto;
      border: 1px solid #0a84ff;
      padding: 10px;
      margin-bottom: 10px;
      background: #111;
      font-family: monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    #messageInput {
      width: 80%;
      padding: 10px;
      border-radius: 5px;
      border: none;
      font-size: 16px;
    }
    #sendButton {
      width: 18%;
      padding: 10px;
      background: #0a84ff;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
      font-size: 16px;
    }
    #sendButton:hover {
      background: #006fcc;
    }
  </style>
</head>
<body>
  <h1>Choose a Case to Open</h1>
  <div class="cases-grid">
    <a href="cases/final-nail.html" class="case-card">
      <img src="images/cases/final-nail.jpg" alt="Final Nail in the Coffin" />
      <div class="case-name">Final Nail in the Coffin</div>
    </a>
    <a href="cases/10-percent-cotton.html" class="case-card">
      <img src="images/cases/10-percent-cotton.jpg" alt="10% Cotton" />
      <div class="case-name">10% Cotton</div>
    </a>
    <a href="cases/lucky-mutant.html" class="case-card">
      <img src="images/cases/lucky-mutant.jpg" alt="Lucky Mutant" />
      <div class="case-name">Lucky Mutant</div>
    </a>
  </div>

  <!-- Chat container -->
  <div id="chat">
    <h2>Live Chat</h2>
    <div id="messages"></div>
    <input type="text" id="messageInput" placeholder="Type a message..." />
    <button id="sendButton">Send</button>
  </div>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // Initialize Supabase client
    const supabaseUrl = 'https://rkxkrfjeqtxrkbgjutvf.supabase.co'; // Your Supabase project URL
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJreGtyZmplcXR4cmtiZ2p1dHZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyODEwMDUsImV4cCI6MjA2NTg1NzAwNX0.sJjLFBn3FZRwjJNRuRozzNea85CK7KYa_QGRZcVvmeA'; // Your anon public API key

    // Fix here: use createClient() from the loaded supabase script, not supabase.createClient
    const supabase = createClient(supabaseUrl, supabaseKey);

    const messagesDiv = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');

    // Add a message element to the chat
    function addMessage(message) {
      const msgEl = document.createElement('div');
      msgEl.textContent = message;
      msgEl.style.padding = '6px 0';
      messagesDiv.appendChild(msgEl);
      messagesDiv.scrollTop = messagesDiv.scrollHeight; // scroll to bottom
    }

    // Load previous messages
    async function loadMessages() {
      let { data, error } = await supabase
        .from('messages')
        .select('*')
        .order('created_at', { ascending: true })
        .limit(50);

      if (error) {
        console.error('Error loading messages:', error);
        return;
      }

      data.forEach(msg => addMessage(msg.content));
    }

    // Subscribe to new messages realtime
    supabase
      .channel('public:messages')
      .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages' }, payload => {
        addMessage(payload.new.content);
      })
      .subscribe();

    // Send message handler
    sendButton.addEventListener('click', async () => {
      const content = messageInput.value.trim();
      if (!content) return;

      const { error } = await supabase
        .from('messages')
        .insert([{ content }]);

      if (error) {
        console.error('Error sending message:', error);
        return;
      }

      messageInput.value = '';
    });

    // Load messages on page load
    loadMessages();
  </script>
</body>
</html>
